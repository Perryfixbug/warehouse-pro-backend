<%= form_with model: @order,
              method: :post,
              data: { controller: "order-form", turbo: false },
              class: "space-y-8 bg-white shadow-lg rounded-2xl p-8 border border-gray-100" do |f| %>

  <!-- üß≠ Header -->
  <div class="flex items-center justify-between border-b pb-4">
    <h2 class="text-2xl font-semibold text-gray-800">
      <%= @order.is_a?(ImportOrder) ? "üì¶ T·∫°o phi·∫øu nh·∫≠p h√†ng" : "üöö T·∫°o phi·∫øu xu·∫•t h√†ng" %>
    </h2>
    <span class="text-sm text-gray-500 italic">Ng∆∞·ªùi t·∫°o: <%= current_user.fullname %></span>
  </div>

  <!-- üîç Ch·ªçn ƒë·∫°i l√Ω -->
  <div class="space-y-2">
    <label class="block text-gray-700 font-medium">T√¨m ƒë·∫°i l√Ω</label>
    <div class="relative">
      <input type="text"
             placeholder="Nh·∫≠p ID ho·∫∑c t√™n ƒë·∫°i l√Ω..."
             class="border border-gray-300 focus:border-green-500 focus:ring-green-200 rounded-lg w-full p-3 transition"
             data-order-form-target="agencyInput"
             data-action="input->order-form#searchAgency">

      <div class="absolute left-0 right-0 mt-1 hidden bg-white border border-gray-200 rounded-lg shadow-md z-10"
           data-order-form-target="agencyResults"></div>
    </div>

    <div class="mt-2 text-green-600 font-medium flex items-center gap-2"
         data-order-form-target="selectedAgency">
    </div>

    <%= f.hidden_field :agency_id, data: { order_form_target: "agencyHidden" } %>
  </div>

  <!-- üßæ Ch·ªçn s·∫£n ph·∫©m -->
  <div class="space-y-2">
    <label class="block text-gray-700 font-medium">T√¨m s·∫£n ph·∫©m</label>
    <div class="relative">
      <input type="text"
             placeholder="Nh·∫≠p t√™n ho·∫∑c m√£ s·∫£n ph·∫©m..."
             class="border border-gray-300 focus:border-green-500 focus:ring-green-200 rounded-lg w-full p-3 transition"
             data-order-form-target="productInput"
             data-action="input->order-form#searchProduct">

      <ul class="absolute left-0 right-0 mt-1 hidden bg-white border border-gray-200 rounded-lg shadow-md z-10 divide-y divide-gray-100"
          data-order-form-target="productResults"></ul>
    </div>
  </div>

  <!-- üßÆ Danh s√°ch s·∫£n ph·∫©m -->
  <div class="space-y-3">
    <h3 class="text-lg font-semibold text-gray-800 flex items-center gap-2">
      üßæ Danh s√°ch s·∫£n ph·∫©m ƒë√£ ch·ªçn
    </h3>

    <ul class="border border-gray-200 rounded-lg divide-y divide-gray-100 bg-gray-50"
        data-order-form-target="selectedProducts">
      <!-- Stimulus s·∫Ω render v√†o ƒë√¢y -->
    </ul>
  </div>

  <!-- üîí Hidden nested fields -->
  <div data-order-form-target="hiddenFields">
    <% @order.ordered_products.each do |op| %>
      <%= f.fields_for :ordered_products, op do |of| %>
        <%= of.hidden_field :product_id %>
        <%= of.hidden_field :quantity %>
      <% end %>
    <% end %>
  </div>

  <!-- ‚úÖ Submit -->
  <div class="pt-6 flex justify-end border-t">
    <%= f.submit "üíæ X√°c nh·∫≠n ƒë∆°n h√†ng",
          class: "bg-green-600 hover:bg-green-700 text-white font-semibold px-8 py-3 rounded-lg shadow-md transition active:scale-[0.98]" %>
  </div>

<% end %>
